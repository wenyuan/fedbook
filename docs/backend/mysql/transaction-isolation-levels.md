# MySQL 事务的隔离性

MySQL 中有三个常见的问题：脏读、不可重复读和幻读。它们都是由于数据库并发访问导致的数据读取问题，都与事务隔离性有关。

## 事务

### 什么是事务

事务是数据库操作的最小工作单元，它是一系列不可再分割的操作集合，这些操作作为一个整体一起向系统提交，要么都执行、要么都不执行。

> 大白话：事务就是把一组操作打包到一起，执行的时候来保证这一组操作能被正确的执行。

例如网上购物的交易过程：

* 更新客户所购商品的库存信息
* 保存客户付款信息
* 生成订单并且保存到数据库中
* 更新用户相关信息，例如购物数量等

在正常情况下，这些操作都将顺利执行，最终交易成功，与交易相关的所有数据库信息也成功地更新。但是，如果遇到断电或者是其他意外情况，导致这一系列过程中任何一个环节出了差错，都将导致整个交易过程失败。**而一旦交易失败，数据库中所有信息都必须保持交易前的状态不变**。否则数据库的信息将会不一致，或者出现更为严重的不可预测的后果。

用伪代码表示事务过程大致是这样的：

```java
try {
    // 设置事务手动提交
    // 默认为自动提交，每当执行一个 update，delete 或 insert 时会自动提交到数据库，无法回滚事务
    connection.setAutoCommit(false);
    
    数据库操作...

    // 提交事务
    connection.commit();
} catch(Exception ex){
    connection.rollback();
} finally {
    connection.setAutoCommit(true);
}
```

### 事务四大特性

* 原子性  
  事务是一个原子性质的操作单元，事务里面的对数据库的操作要么都执行，要么都不执行（回滚机制）。
* 一致性  
  事务执行的结果必须是使数据库从一个一致性状态变到另一个一致性状态。因此当数据库只包含成功事务提交的结果时，就说数据库处于一致性状态。如果数据库系统运行中发生故障，有些事务尚未完成就被迫中断，这些未完成事务对数据库所做的修改有一部分已写入物理数据库，这时数据库就处于一种不正确的状态，或者说是不一致的状态。
* 隔离性  
  一个事务的执行不能被其他事务干扰。即一个事务内部的操作及使用的数据对其他并发事务是隔离的，并发执行的各个事务之间不能互相干扰。
* 持续性  
  也称永久性，指一个事务一旦提交，它对数据库中的数据的改变就应该是永久性的。接下来的其他操作或故障不应该对其执行结果有任何影响。

### 事务的隔离级别

MySQL 提供了四种隔离级别，用来应对多个客户端同时操作数据库的某张表这种情况。根据这种机制，可以让不同的事务在操作数据时，具有隔离性。从而保证数据的一致性。

以下是四种隔离级别：

* 读未提交（read uncommitted）  
  在这种隔离级别下，所有事务能够读取其他事务未提交的数据。**读取其他事务未提交的数据，会造成脏读**。因此在该种隔离级别下，不能解决脏读、不可重复读和幻读。
* 读已提交（read committed）：Oracle 和 SQLServer 默认的隔离级别
  在这种隔离级别下，所有事务只能读取其他事务已经提交的内容。能够彻底解决脏读的现象。但在这种隔离级别下，会出现一个事务的前后多次的查询中却返回了不同内容的数据的现象，**也就是出现了不可重复读**。
* 可重复读（repeatable read）：MySQL 默认的隔离级别  
  在这种隔离级别下，所有事务前后多次的读取到的数据内容是不变的。也就是某个事务在执行的过程中，不允许其他事务进行 update 操作，但允许其他事务进行 add 操作，造成某个事务前后多次读取到的数据总量不一致的现象，**从而产生幻读**。
* 可串行化（serializable）  
  在这种隔离级别下，所有的事务顺序执行，所以他们之间不存在冲突，从而能有效地解决脏读、不可重复读和幻读的现象。但是安全和效率不能兼得，这样事务隔离级别，会导致大量的操作超时和锁竞争，**从而大大降低数据库的性能**，一般不使用这样事务隔离级别。

总结一下如下表所示：（√ 表示解决，× 表示未解决）

<svg id="SvgjsSvg1006" width="751" height="224" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1007"></defs><g id="SvgjsG1008" transform="translate(25,25)"><path id="SvgjsPath1009" d="M0 0L259.0195 0L259.0195 34.7964 L0 34.7964Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><path id="SvgjsPath1010" d="M259.0195 0L389.6158 0L389.6158 34.7964 L259.0195 34.7964Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><path id="SvgjsPath1011" d="M389.6158 0L541.5225 0L541.5225 34.7964 L389.6158 34.7964Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><path id="SvgjsPath1012" d="M541.5224999999999 0L701 0L701 34.7964 L541.5224999999999 34.7964Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><path id="SvgjsPath1013" d="M0 34.7964L259.0195 34.7964L259.0195 69.5928 L0 69.5928Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1014" d="M259.0195 34.7964L389.6158 34.7964L389.6158 69.5928 L259.0195 69.5928Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1015" d="M389.6158 34.7964L541.5225 34.7964L541.5225 69.5928 L389.6158 69.5928Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1016" d="M541.5224999999999 34.7964L701 34.7964L701 69.5928 L541.5224999999999 69.5928Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1017" d="M0 69.5928L259.0195 69.5928L259.0195 104.38919999999999 L0 104.38919999999999Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1018" d="M259.0195 69.5928L389.6158 69.5928L389.6158 104.38919999999999 L259.0195 104.38919999999999Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1019" d="M389.6158 69.5928L541.5225 69.5928L541.5225 104.38919999999999 L389.6158 104.38919999999999Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1020" d="M541.5224999999999 69.5928L701 69.5928L701 104.38919999999999 L541.5224999999999 104.38919999999999Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1021" d="M0 104.3892L259.0195 104.3892L259.0195 139.2029982 L0 139.2029982Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1022" d="M259.0195 104.3892L389.6158 104.3892L389.6158 139.2029982 L259.0195 139.2029982Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1023" d="M389.6158 104.3892L541.5225 104.3892L541.5225 139.2029982 L389.6158 139.2029982Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1024" d="M541.5224999999999 104.3892L701 104.3892L701 139.2029982 L541.5224999999999 139.2029982Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1025" d="M0 139.1856L259.0195 139.1856L259.0195 173.982 L0 173.982Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1026" d="M259.0195 139.1856L389.6158 139.1856L389.6158 173.982 L259.0195 173.982Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1027" d="M389.6158 139.1856L541.5225 139.1856L541.5225 173.982 L389.6158 173.982Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1028" d="M541.5224999999999 139.1856L701 139.1856L701 173.982 L541.5224999999999 173.982Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1029"><text id="SvgjsText1030" font-family="微软雅黑" text-anchor="start" font-size="16px" width="260px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="3.398199999999999" transform="rotate(0)"></text></g><g id="SvgjsG1031"><text id="SvgjsText1032" font-family="微软雅黑" text-anchor="start" font-size="16px" width="131px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="13.3982" transform="rotate(0)"></text></g><g id="SvgjsG1033"><text id="SvgjsText1034" font-family="微软雅黑" text-anchor="start" font-size="16px" width="152px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="13.3982" transform="rotate(0)"></text></g><g id="SvgjsG1035"><text id="SvgjsText1036" font-family="微软雅黑" text-anchor="start" font-size="16px" width="160px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="3.398199999999999" transform="rotate(0)"></text></g><g id="SvgjsG1037"><text id="SvgjsText1038" font-family="微软雅黑" text-anchor="start" font-size="16px" width="260px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="38.194599999999994" transform="rotate(0)"><tspan id="SvgjsTspan1039" dy="20" x="0"><tspan id="SvgjsTspan1040" style="text-decoration:;">  读未提交（read uncommitted）</tspan></tspan></text></g><g id="SvgjsG1041"><text id="SvgjsText1042" font-family="微软雅黑" text-anchor="start" font-size="16px" width="131px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="38.194599999999994" transform="rotate(0)"><tspan id="SvgjsTspan1043" dy="20" x="259.0195"><tspan id="SvgjsTspan1044" style="text-decoration:;">  ×</tspan></tspan></text></g><g id="SvgjsG1045"><text id="SvgjsText1046" font-family="微软雅黑" text-anchor="start" font-size="16px" width="152px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="38.194599999999994" transform="rotate(0)"><tspan id="SvgjsTspan1047" dy="20" x="389.6158"><tspan id="SvgjsTspan1048" style="text-decoration:;">  ×</tspan></tspan></text></g><g id="SvgjsG1049"><text id="SvgjsText1050" font-family="微软雅黑" text-anchor="start" font-size="16px" width="160px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="38.194599999999994" transform="rotate(0)"><tspan id="SvgjsTspan1051" dy="20" x="541.5224999999999"><tspan id="SvgjsTspan1052" style="text-decoration:;">  ×</tspan></tspan></text></g><g id="SvgjsG1053"><text id="SvgjsText1054" font-family="微软雅黑" text-anchor="start" font-size="16px" width="260px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="72.991" transform="rotate(0)"><tspan id="SvgjsTspan1055" dy="20" x="0"><tspan id="SvgjsTspan1056" style="text-decoration:;">  读已提交（read committed）</tspan></tspan></text></g><g id="SvgjsG1057"><text id="SvgjsText1058" font-family="微软雅黑" text-anchor="start" font-size="16px" width="131px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="72.991" transform="rotate(0)"><tspan id="SvgjsTspan1059" dy="20" x="259.0195"><tspan id="SvgjsTspan1060" style="text-decoration:;">  √</tspan></tspan></text></g><g id="SvgjsG1061"><text id="SvgjsText1062" font-family="微软雅黑" text-anchor="start" font-size="16px" width="152px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="72.991" transform="rotate(0)"><tspan id="SvgjsTspan1063" dy="20" x="389.6158"><tspan id="SvgjsTspan1064" style="text-decoration:;">  ×</tspan></tspan></text></g><g id="SvgjsG1065"><text id="SvgjsText1066" font-family="微软雅黑" text-anchor="start" font-size="16px" width="160px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="72.991" transform="rotate(0)"><tspan id="SvgjsTspan1067" dy="20" x="541.5224999999999"><tspan id="SvgjsTspan1068" style="text-decoration:;">  ×</tspan></tspan></text></g><g id="SvgjsG1069"><text id="SvgjsText1070" font-family="微软雅黑" text-anchor="start" font-size="16px" width="260px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="107.7960991" transform="rotate(0)"><tspan id="SvgjsTspan1071" dy="20" x="0"><tspan id="SvgjsTspan1072" style="text-decoration:;">  可重复读（repeatable read）</tspan></tspan></text></g><g id="SvgjsG1073"><text id="SvgjsText1074" font-family="微软雅黑" text-anchor="start" font-size="16px" width="131px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="107.7960991" transform="rotate(0)"><tspan id="SvgjsTspan1075" dy="20" x="259.0195"><tspan id="SvgjsTspan1076" style="text-decoration:;">  √</tspan></tspan></text></g><g id="SvgjsG1077"><text id="SvgjsText1078" font-family="微软雅黑" text-anchor="start" font-size="16px" width="152px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="107.7960991" transform="rotate(0)"><tspan id="SvgjsTspan1079" dy="20" x="389.6158"><tspan id="SvgjsTspan1080" style="text-decoration:;">  √</tspan></tspan></text></g><g id="SvgjsG1081"><text id="SvgjsText1082" font-family="微软雅黑" text-anchor="start" font-size="16px" width="160px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="107.7960991" transform="rotate(0)"><tspan id="SvgjsTspan1083" dy="20" x="541.5224999999999"><tspan id="SvgjsTspan1084" style="text-decoration:;">  ×</tspan></tspan></text></g><g id="SvgjsG1085"><text id="SvgjsText1086" font-family="微软雅黑" text-anchor="start" font-size="16px" width="260px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="142.5838" transform="rotate(0)"><tspan id="SvgjsTspan1087" dy="20" x="0"><tspan id="SvgjsTspan1088" style="text-decoration:;">  可串行化（serializable）</tspan></tspan></text></g><g id="SvgjsG1089"><text id="SvgjsText1090" font-family="微软雅黑" text-anchor="start" font-size="16px" width="131px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="142.5838" transform="rotate(0)"><tspan id="SvgjsTspan1091" dy="20" x="259.0195"><tspan id="SvgjsTspan1092" style="text-decoration:;">  √</tspan></tspan></text></g><g id="SvgjsG1093"><text id="SvgjsText1094" font-family="微软雅黑" text-anchor="start" font-size="16px" width="152px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="142.5838" transform="rotate(0)"><tspan id="SvgjsTspan1095" dy="20" x="389.6158"><tspan id="SvgjsTspan1096" style="text-decoration:;">  √</tspan></tspan></text></g><g id="SvgjsG1097"><text id="SvgjsText1098" font-family="微软雅黑" text-anchor="start" font-size="16px" width="160px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="142.5838" transform="rotate(0)"><tspan id="SvgjsTspan1099" dy="20" x="541.5224999999999"><tspan id="SvgjsTspan1100" style="text-decoration:;">  √</tspan></tspan></text></g></g><g id="SvgjsG1101" transform="translate(25,25)"><path id="SvgjsPath1102" d="M0 0L259.0195 0L259.0195 34.7945 L0 34.7945Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><path id="SvgjsPath1103" d="M259.0195 0L389.6158 0L389.6158 34.7945 L259.0195 34.7945Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><path id="SvgjsPath1104" d="M389.6158 0L541.5225 0L541.5225 34.7945 L389.6158 34.7945Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><path id="SvgjsPath1105" d="M541.5224999999999 0L701 0L701 34.7945 L541.5224999999999 34.7945Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><g id="SvgjsG1106"><text id="SvgjsText1107" font-family="微软雅黑" text-anchor="start" font-size="16px" width="260px" fill="#323232" font-weight="700" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="700" font-style="" opacity="1" y="3.3972499999999997" transform="rotate(0)"><tspan id="SvgjsTspan1108" dy="20" x="0"><tspan id="SvgjsTspan1109" style="text-decoration:;">  隔离级别</tspan></tspan></text></g><g id="SvgjsG1110"><text id="SvgjsText1111" font-family="微软雅黑" text-anchor="start" font-size="16px" width="131px" fill="#323232" font-weight="700" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="700" font-style="" opacity="1" y="3.3972499999999997" transform="rotate(0)"><tspan id="SvgjsTspan1112" dy="20" x="259.0195"><tspan id="SvgjsTspan1113" style="text-decoration:;">  脏读</tspan></tspan></text></g><g id="SvgjsG1114"><text id="SvgjsText1115" font-family="微软雅黑" text-anchor="start" font-size="16px" width="152px" fill="#323232" font-weight="700" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="700" font-style="" opacity="1" y="3.3972499999999997" transform="rotate(0)"><tspan id="SvgjsTspan1116" dy="20" x="389.6158"><tspan id="SvgjsTspan1117" style="text-decoration:;">  不可重复读</tspan></tspan></text></g><g id="SvgjsG1118"><text id="SvgjsText1119" font-family="微软雅黑" text-anchor="start" font-size="16px" width="160px" fill="#323232" font-weight="700" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="700" font-style="" opacity="1" y="3.3972499999999997" transform="rotate(0)"><tspan id="SvgjsTspan1120" dy="20" x="541.5224999999999"><tspan id="SvgjsTspan1121" style="text-decoration:;">  幻读</tspan></tspan></text></g></g></svg>

## 无隔离性的问题

如果事务没有隔离性，就会引发脏读、不可重复读和幻读的问题。

### 脏读（读取未提交数据）

A 事务读取 B 事务尚未提交的数据，此时如果 B 事务发生错误并执行回滚操作，那么 A 事务读取到的数据就是脏数据。

以转账与取款操作为例：

<svg id="SvgjsSvg1139" width="877" height="468" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1140"></defs><g id="SvgjsG1141" transform="translate(25,25)"><path id="SvgjsPath1142" d="M0 0L90.97198 0L90.97198 40.0016496 L0 40.0016496Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><path id="SvgjsPath1143" d="M90.97198 0L401.7653444 0L401.7653444 40.0016496 L90.97198 40.0016496Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><path id="SvgjsPath1144" d="M401.8480462 0L827.018 0L827.018 40.0016496 L401.8480462 40.0016496Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><path id="SvgjsPath1145" d="M0 40.0016496L90.97198 40.0016496L90.97198 80.0032992 L0 80.0032992Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1146" d="M90.97198 40.0016496L401.7653444 40.0016496L401.7653444 80.0032992 L90.97198 80.0032992Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1147" d="M401.8480462 40.0016496L827.018 40.0016496L827.018 80.0032992 L401.8480462 80.0032992Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1148" d="M0 80.0032992L90.97198 80.0032992L90.97198 120.0049488 L0 120.0049488Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1149" d="M90.97198 80.0032992L401.7653444 80.0032992L401.7653444 120.0049488 L90.97198 120.0049488Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1150" d="M401.8480462 80.0032992L827.018 80.0032992L827.018 120.0049488 L401.8480462 120.0049488Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1151" d="M0 120.00494880000001L90.97198 120.00494880000001L90.97198 160.0065984 L0 160.0065984Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1152" d="M90.97198 120.00494880000001L401.7653444 120.00494880000001L401.7653444 160.0065984 L90.97198 160.0065984Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1153" d="M401.8480462 120.00494880000001L827.018 120.00494880000001L827.018 160.0065984 L401.8480462 160.0065984Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1154" d="M0 160.0065984L90.97198 160.0065984L90.97198 200.008248 L0 200.008248Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1155" d="M90.97198 160.0065984L401.7653444 160.0065984L401.7653444 200.008248 L90.97198 200.008248Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1156" d="M401.8480462 160.0065984L827.018 160.0065984L827.018 200.008248 L401.8480462 200.008248Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1157" d="M0 200.008248L90.97198 200.008248L90.97198 240.00989760000002 L0 240.00989760000002Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1158" d="M90.97198 200.008248L401.7653444 200.008248L401.7653444 240.00989760000002 L90.97198 240.00989760000002Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1159" d="M401.8480462 200.008248L827.018 200.008248L827.018 240.00989760000002 L401.8480462 240.00989760000002Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1160" d="M0 240.00989760000002L90.97198 240.00989760000002L90.97198 279.9357865 L0 279.9357865Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1161" d="M90.97198 240.00989760000002L401.7653444 240.00989760000002L401.7653444 279.9357865 L90.97198 279.9357865Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1162" d="M401.8480462 240.00989760000002L827.018 240.00989760000002L827.018 279.9357865 L401.8480462 279.9357865Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1163" d="M0 279.9357865L90.97198 279.9357865L90.97198 338.83973075 L0 338.83973075Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1164" d="M90.97198 279.9357865L401.7653444 279.9357865L401.7653444 338.83973075 L90.97198 338.83973075Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1165" d="M401.8480462 279.9357865L827.018 279.9357865L827.018 338.83973075 L401.8480462 338.83973075Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1166" d="M0 338.83973074999994L90.97198 338.83973074999994L90.97198 378.8035 L0 378.8035Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1167" d="M90.97198 338.83973074999994L401.7653444 338.83973074999994L401.7653444 378.8035 L90.97198 378.8035Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1168" d="M401.8480462 338.83973074999994L827.018 338.83973074999994L827.018 378.8035 L401.8480462 378.8035Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1169"><text id="SvgjsText1170" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="2.0008248" transform="rotate(0)"><tspan id="SvgjsTspan1171" dy="24" x="0"><tspan id="SvgjsTspan1172" style="text-decoration:;">  时间顺序</tspan></tspan></text></g><g id="SvgjsG1173"><text id="SvgjsText1174" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="2.0008248" transform="rotate(0)"><tspan id="SvgjsTspan1175" dy="24" x="90.97198"><tspan id="SvgjsTspan1176" style="text-decoration:;">  转账事务</tspan></tspan></text></g><g id="SvgjsG1177"><text id="SvgjsText1178" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="2.0008248" transform="rotate(0)"><tspan id="SvgjsTspan1179" dy="24" x="401.8480462"><tspan id="SvgjsTspan1180" style="text-decoration:;">  取款事务</tspan></tspan></text></g><g id="SvgjsG1181"><text id="SvgjsText1182" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="42.0024744" transform="rotate(0)"><tspan id="SvgjsTspan1183" dy="24" x="0"><tspan id="SvgjsTspan1184" style="text-decoration:;">  1</tspan></tspan></text></g><g id="SvgjsG1185"><text id="SvgjsText1186" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="42.0024744" transform="rotate(0)"></text></g><g id="SvgjsG1187"><text id="SvgjsText1188" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="42.0024744" transform="rotate(0)"><tspan id="SvgjsTspan1189" dy="24" x="401.8480462"><tspan id="SvgjsTspan1190" style="text-decoration:;">  开始事务</tspan></tspan></text></g><g id="SvgjsG1191"><text id="SvgjsText1192" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="82.004124" transform="rotate(0)"><tspan id="SvgjsTspan1193" dy="24" x="0"><tspan id="SvgjsTspan1194" style="text-decoration:;">  2</tspan></tspan></text></g><g id="SvgjsG1195"><text id="SvgjsText1196" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="82.004124" transform="rotate(0)"><tspan id="SvgjsTspan1197" dy="24" x="90.97198"><tspan id="SvgjsTspan1198" style="text-decoration:;">  开始事务</tspan></tspan></text></g><g id="SvgjsG1199"><text id="SvgjsText1200" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="82.004124" transform="rotate(0)"></text></g><g id="SvgjsG1201"><text id="SvgjsText1202" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="122.0057736" transform="rotate(0)"><tspan id="SvgjsTspan1203" dy="24" x="0"><tspan id="SvgjsTspan1204" style="text-decoration:;">  3</tspan></tspan></text></g><g id="SvgjsG1205"><text id="SvgjsText1206" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="122.0057736" transform="rotate(0)"></text></g><g id="SvgjsG1207"><text id="SvgjsText1208" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="122.0057736" transform="rotate(0)"><tspan id="SvgjsTspan1209" dy="24" x="401.8480462"><tspan id="SvgjsTspan1210" style="text-decoration:;">  查询账户余额为 2000 元</tspan></tspan></text></g><g id="SvgjsG1211"><text id="SvgjsText1212" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="162.0074232" transform="rotate(0)"><tspan id="SvgjsTspan1213" dy="24" x="0"><tspan id="SvgjsTspan1214" style="text-decoration:;">  4</tspan></tspan></text></g><g id="SvgjsG1215"><text id="SvgjsText1216" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="162.0074232" transform="rotate(0)"></text></g><g id="SvgjsG1217"><text id="SvgjsText1218" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="162.0074232" transform="rotate(0)"><tspan id="SvgjsTspan1219" dy="24" x="401.8480462"><tspan id="SvgjsTspan1220" style="text-decoration:;">  取款 1000 元，余额被更改为 1000 元</tspan></tspan></text></g><g id="SvgjsG1221"><text id="SvgjsText1222" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="202.0090728" transform="rotate(0)"><tspan id="SvgjsTspan1223" dy="24" x="0"><tspan id="SvgjsTspan1224" style="text-decoration:;">  5</tspan></tspan></text></g><g id="SvgjsG1225"><text id="SvgjsText1226" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="202.0090728" transform="rotate(0)"><tspan id="SvgjsTspan1227" dy="24" x="90.97198"><tspan id="SvgjsTspan1228" style="text-decoration:;">  查询账户余额为 1000 元（产生脏读）</tspan></tspan></text></g><g id="SvgjsG1229"><text id="SvgjsText1230" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="202.0090728" transform="rotate(0)"></text></g><g id="SvgjsG1231"><text id="SvgjsText1232" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="241.97284205000003" transform="rotate(0)"><tspan id="SvgjsTspan1233" dy="24" x="0"><tspan id="SvgjsTspan1234" style="text-decoration:;">  6</tspan></tspan></text></g><g id="SvgjsG1235"><text id="SvgjsText1236" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="241.97284205000003" transform="rotate(0)"></text></g><g id="SvgjsG1237"><text id="SvgjsText1238" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="241.97284205000003" transform="rotate(0)"><tspan id="SvgjsTspan1239" dy="24" x="401.8480462"><tspan id="SvgjsTspan1240" style="text-decoration:;">  取款操作发生未知错误，事务回滚，余额变更为 2000 元</tspan></tspan></text></g><g id="SvgjsG1241"><text id="SvgjsText1242" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="291.387758625" transform="rotate(0)"><tspan id="SvgjsTspan1243" dy="24" x="0"><tspan id="SvgjsTspan1244" style="text-decoration:;">  7</tspan></tspan></text></g><g id="SvgjsG1245"><text id="SvgjsText1246" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="279.387758625" transform="rotate(0)"><tspan id="SvgjsTspan1247" dy="24" x="90.97198"><tspan id="SvgjsTspan1248" style="text-decoration:;">  转入 2000 元，余额被更改为 3000 元</tspan></tspan><tspan id="SvgjsTspan1249" dy="24" x="90.97198"><tspan id="SvgjsTspan1250" style="text-decoration:;">（脏读的 1000+2000）</tspan></tspan></text></g><g id="SvgjsG1251"><text id="SvgjsText1252" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="291.387758625" transform="rotate(0)"></text></g><g id="SvgjsG1253"><text id="SvgjsText1254" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="340.82161537499996" transform="rotate(0)"><tspan id="SvgjsTspan1255" dy="24" x="0"><tspan id="SvgjsTspan1256" style="text-decoration:;">  8</tspan></tspan></text></g><g id="SvgjsG1257"><text id="SvgjsText1258" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="340.82161537499996" transform="rotate(0)"><tspan id="SvgjsTspan1259" dy="24" x="90.97198"><tspan id="SvgjsTspan1260" style="text-decoration:;">  提交事务</tspan></tspan></text></g><g id="SvgjsG1261"><text id="SvgjsText1262" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="340.82161537499996" transform="rotate(0)"></text></g></g><g id="SvgjsG1263" transform="translate(25,403)"><path id="SvgjsPath1264" d="M0 0L91.00736964000001 0L91.00736964000001 40.0077 L0 40.0077Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><path id="SvgjsPath1265" d="M91.00736964000001 0L825.8382 0L825.8382 40.0077 L91.00736964000001 40.0077Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><g id="SvgjsG1266"><text id="SvgjsText1267" font-family="微软雅黑" text-anchor="start" font-size="16px" width="92px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="6.00385" transform="rotate(0)"><tspan id="SvgjsTspan1268" dy="20" x="0"><tspan id="SvgjsTspan1269" style="text-decoration:;">  备注</tspan></tspan></text></g><g id="SvgjsG1270"><text id="SvgjsText1271" font-family="微软雅黑" text-anchor="start" font-size="16px" width="735px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="6.00385" transform="rotate(0)"><tspan id="SvgjsTspan1272" dy="20" x="91.00736964000001"><tspan id="SvgjsTspan1273" style="text-decoration:;">  按照正确逻辑，此时账户余额应该为 4000 元</tspan></tspan></text></g></g></svg>

解决脏读的办法：给写操作加锁。

B 事务在修改数据的过程中（提交之前），A 事务尝试读，就会阻塞，一直阻塞到 B 提交数据之后，A 才能读取数据。

但要注意的是：引入写加锁，事务的并发程度就降低了，效率也就低了，隔离性高了。

### 不可重复读（前后多次读取，数据内容不一致）

事务 A 在执行读取操作，由整个事务 A 比较大，前后读取同一条数据需要经历很长的时间。而在事务 A 第一次读取数据，比如此时读取了小明的年龄为 20 岁，事务 B 执行更改操作，将小明的年龄更改为 30 岁，此时事务 A 第二次读取到小明的年龄时，发现其年龄是 30 岁，和之前的数据不一样了，也就是数据不重复了，系统不可以读取到重复的数据，成为不可重复读。

<svg id="SvgjsSvg1274" width="877" height="411" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1275"></defs><g id="SvgjsG1276" transform="translate(25.003850000000057,25)"><path id="SvgjsPath1277" d="M0 0L90.97198 0L90.97198 40.00785016 L0 40.00785016Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><path id="SvgjsPath1278" d="M90.97198 0L401.7653444 0L401.7653444 40.00785016 L90.97198 40.00785016Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><path id="SvgjsPath1279" d="M401.7653444 0L827.018 0L827.018 40.00785016 L401.7653444 40.00785016Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><path id="SvgjsPath1280" d="M0 40.00785016L90.97198 40.00785016L90.97198 80.01570032 L0 80.01570032Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1281" d="M90.97198 40.00785016L401.7653444 40.00785016L401.7653444 80.01570032 L90.97198 80.01570032Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1282" d="M401.7653444 40.00785016L827.018 40.00785016L827.018 80.01570032 L401.7653444 80.01570032Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1283" d="M0 80.01570032L90.97198 80.01570032L90.97198 120.02355047999998 L0 120.02355047999998Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1284" d="M90.97198 80.01570032L401.7653444 80.01570032L401.7653444 120.02355047999998 L90.97198 120.02355047999998Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1285" d="M401.7653444 80.01570032L827.018 80.01570032L827.018 120.02355047999998 L401.7653444 120.02355047999998Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1286" d="M0 120.05563375999998L90.97198 120.05563375999998L90.97198 160.06348391999998 L0 160.06348391999998Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1287" d="M90.97198 120.05563375999998L401.7653444 120.05563375999998L401.7653444 160.06348391999998 L90.97198 160.06348391999998Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1288" d="M401.7653444 120.05563375999998L827.018 120.05563375999998L827.018 160.06348391999998 L401.7653444 160.06348391999998Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1289" d="M0 160.06348391999998L90.97198 160.06348391999998L90.97198 200.07133407999999 L0 200.07133407999999Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1290" d="M90.97198 160.06348391999998L401.7653444 160.06348391999998L401.7653444 200.07133407999999 L90.97198 200.07133407999999Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1291" d="M401.7653444 160.06348391999998L827.018 160.06348391999998L827.018 200.07133407999999 L401.7653444 200.07133407999999Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1292" d="M0 200.07133407999999L90.97198 200.07133407999999L90.97198 240.07918424 L0 240.07918424Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1293" d="M90.97198 200.07133407999999L401.7653444 200.07133407999999L401.7653444 240.07918424 L90.97198 240.07918424Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1294" d="M401.7653444 200.07133407999999L827.018 200.07133407999999L827.018 240.07918424 L401.7653444 240.07918424Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1295" d="M0 240.07918423999996L90.97198 240.07918423999996L90.97198 280.02286783999995 L0 280.02286783999995Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1296" d="M90.97198 240.07918423999996L401.7653444 240.07918423999996L401.7653444 280.02286783999995 L90.97198 280.02286783999995Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1297" d="M401.7653444 240.07918423999996L827.018 240.07918423999996L827.018 280.02286783999995 L401.7653444 280.02286783999995Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1298" d="M0 280.02286783999995L90.97198 280.02286783999995L90.97198 320.83279999999996 L0 320.83279999999996Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1299" d="M90.97198 280.02286783999995L401.7653444 280.02286783999995L401.7653444 320.83279999999996 L90.97198 320.83279999999996Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1300" d="M401.7653444 280.02286783999995L827.018 280.02286783999995L827.018 320.83279999999996 L401.7653444 320.83279999999996Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1301"><text id="SvgjsText1302" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="2.0039250799999984" transform="rotate(0)"><tspan id="SvgjsTspan1303" dy="24" x="0"><tspan id="SvgjsTspan1304" style="text-decoration:;">  时间顺序</tspan></tspan></text></g><g id="SvgjsG1305"><text id="SvgjsText1306" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="2.0039250799999984" transform="rotate(0)"><tspan id="SvgjsTspan1307" dy="24" x="90.97198"><tspan id="SvgjsTspan1308" style="text-decoration:;">  事务A</tspan></tspan></text></g><g id="SvgjsG1309"><text id="SvgjsText1310" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="2.0039250799999984" transform="rotate(0)"><tspan id="SvgjsTspan1311" dy="24" x="401.7653444"><tspan id="SvgjsTspan1312" style="text-decoration:;">  事务B</tspan></tspan></text></g><g id="SvgjsG1313"><text id="SvgjsText1314" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="42.01177523999999" transform="rotate(0)"><tspan id="SvgjsTspan1315" dy="24" x="0"><tspan id="SvgjsTspan1316" style="text-decoration:;">  1</tspan></tspan></text></g><g id="SvgjsG1317"><text id="SvgjsText1318" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="42.01177523999999" transform="rotate(0)"><tspan id="SvgjsTspan1319" dy="24" x="90.97198"><tspan id="SvgjsTspan1320" style="text-decoration:;">  开始事务</tspan></tspan></text></g><g id="SvgjsG1321"><text id="SvgjsText1322" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="42.01177523999999" transform="rotate(0)"></text></g><g id="SvgjsG1323"><text id="SvgjsText1324" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="82.0196254" transform="rotate(0)"><tspan id="SvgjsTspan1325" dy="24" x="0"><tspan id="SvgjsTspan1326" style="text-decoration:;">  2</tspan></tspan></text></g><g id="SvgjsG1327"><text id="SvgjsText1328" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="82.0196254" transform="rotate(0)"><tspan id="SvgjsTspan1329" dy="24" x="90.97198"><tspan id="SvgjsTspan1330" style="text-decoration:;">  第一次查询，小明的年龄为 20 岁</tspan></tspan></text></g><g id="SvgjsG1331"><text id="SvgjsText1332" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="82.0196254" transform="rotate(0)"></text></g><g id="SvgjsG1333"><text id="SvgjsText1334" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="122.05955883999997" transform="rotate(0)"><tspan id="SvgjsTspan1335" dy="24" x="0"><tspan id="SvgjsTspan1336" style="text-decoration:;">  3</tspan></tspan></text></g><g id="SvgjsG1337"><text id="SvgjsText1338" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="122.05955883999997" transform="rotate(0)"></text></g><g id="SvgjsG1339"><text id="SvgjsText1340" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="122.05955883999997" transform="rotate(0)"><tspan id="SvgjsTspan1341" dy="24" x="401.7653444"><tspan id="SvgjsTspan1342" style="text-decoration:;">  开始事务</tspan></tspan></text></g><g id="SvgjsG1343"><text id="SvgjsText1344" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="162.06740899999997" transform="rotate(0)"><tspan id="SvgjsTspan1345" dy="24" x="0"><tspan id="SvgjsTspan1346" style="text-decoration:;">  4</tspan></tspan></text></g><g id="SvgjsG1347"><text id="SvgjsText1348" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="162.06740899999997" transform="rotate(0)"><tspan id="SvgjsTspan1349" dy="24" x="90.97198"><tspan id="SvgjsTspan1350" style="text-decoration:;">  其他操作</tspan></tspan></text></g><g id="SvgjsG1351"><text id="SvgjsText1352" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="162.06740899999997" transform="rotate(0)"></text></g><g id="SvgjsG1353"><text id="SvgjsText1354" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="202.07525915999997" transform="rotate(0)"><tspan id="SvgjsTspan1355" dy="24" x="0"><tspan id="SvgjsTspan1356" style="text-decoration:;">  5</tspan></tspan></text></g><g id="SvgjsG1357"><text id="SvgjsText1358" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="202.07525915999997" transform="rotate(0)"></text></g><g id="SvgjsG1359"><text id="SvgjsText1360" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="202.07525915999997" transform="rotate(0)"><tspan id="SvgjsTspan1361" dy="24" x="401.7653444"><tspan id="SvgjsTspan1362" style="text-decoration:;">  更改小明的年龄为 30 岁</tspan></tspan></text></g><g id="SvgjsG1363"><text id="SvgjsText1364" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="242.05102603999995" transform="rotate(0)"><tspan id="SvgjsTspan1365" dy="24" x="0"><tspan id="SvgjsTspan1366" style="text-decoration:;">  6</tspan></tspan></text></g><g id="SvgjsG1367"><text id="SvgjsText1368" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="242.05102603999995" transform="rotate(0)"></text></g><g id="SvgjsG1369"><text id="SvgjsText1370" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="242.05102603999995" transform="rotate(0)"><tspan id="SvgjsTspan1371" dy="24" x="401.7653444"><tspan id="SvgjsTspan1372" style="text-decoration:;">  提交事务</tspan></tspan></text></g><g id="SvgjsG1373"><text id="SvgjsText1374" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="282.42783391999996" transform="rotate(0)"><tspan id="SvgjsTspan1375" dy="24" x="0"><tspan id="SvgjsTspan1376" style="text-decoration:;">  7</tspan></tspan></text></g><g id="SvgjsG1377"><text id="SvgjsText1378" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="282.42783391999996" transform="rotate(0)"><tspan id="SvgjsTspan1379" dy="24" x="90.97198"><tspan id="SvgjsTspan1380" style="text-decoration:;">  第二次查询，小明的年龄为30岁</tspan></tspan></text></g><g id="SvgjsG1381"><text id="SvgjsText1382" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="282.42783391999996" transform="rotate(0)"></text></g></g><g id="SvgjsG1383" transform="translate(25.003850000000057,346)"><path id="SvgjsPath1384" d="M0 0L91.00736964000001 0L91.00736964000001 40.0077 L0 40.0077Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><path id="SvgjsPath1385" d="M91.00736964000001 0L825.8382 0L825.8382 40.0077 L91.00736964000001 40.0077Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><g id="SvgjsG1386"><text id="SvgjsText1387" font-family="微软雅黑" text-anchor="start" font-size="16px" width="92px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="6.00385" transform="rotate(0)"><tspan id="SvgjsTspan1388" dy="20" x="0"><tspan id="SvgjsTspan1389" style="text-decoration:;">  备注</tspan></tspan></text></g><g id="SvgjsG1390"><text id="SvgjsText1391" font-family="微软雅黑" text-anchor="start" font-size="16px" width="735px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="6.00385" transform="rotate(0)"><tspan id="SvgjsTspan1392" dy="20" x="91.00736964000001"><tspan id="SvgjsTspan1393" style="text-decoration:;">  按照正确逻辑，事务A前后两次读取到的数据应该一致</tspan></tspan></text></g></g></svg>

解决不可重复读的办法：读也加锁。

但要注意的是：引入读加锁，事务的并发程度就更低了，效率也就更低了，隔离性就更高。

### 幻读（前后多次读取，数据总量不一致）

事务 A 在执行读取操作，需要两次统计数据的总量，前一次查询数据总量后，此时事务 B 执行了新增数据的操作并提交，这个时候事务 A 读取的数据总量和之前统计的不一样，就像产生了幻觉一样，平白无故的多了几条数据，成为幻读。

<svg id="SvgjsSvg1394" width="877" height="411" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1395"></defs><g id="SvgjsG1396" transform="translate(25.003850000000057,25)"><path id="SvgjsPath1397" d="M0 0L90.97198 0L90.97198 40.00785016 L0 40.00785016Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><path id="SvgjsPath1398" d="M90.97198 0L401.7653444 0L401.7653444 40.00785016 L90.97198 40.00785016Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><path id="SvgjsPath1399" d="M401.7653444 0L827.018 0L827.018 40.00785016 L401.7653444 40.00785016Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><path id="SvgjsPath1400" d="M0 40.00785016L90.97198 40.00785016L90.97198 80.01570032 L0 80.01570032Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1401" d="M90.97198 40.00785016L401.7653444 40.00785016L401.7653444 80.01570032 L90.97198 80.01570032Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1402" d="M401.7653444 40.00785016L827.018 40.00785016L827.018 80.01570032 L401.7653444 80.01570032Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1403" d="M0 80.01570032L90.97198 80.01570032L90.97198 120.02355047999998 L0 120.02355047999998Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1404" d="M90.97198 80.01570032L401.7653444 80.01570032L401.7653444 120.02355047999998 L90.97198 120.02355047999998Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1405" d="M401.7653444 80.01570032L827.018 80.01570032L827.018 120.02355047999998 L401.7653444 120.02355047999998Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1406" d="M0 120.05563375999998L90.97198 120.05563375999998L90.97198 160.06348391999998 L0 160.06348391999998Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1407" d="M90.97198 120.05563375999998L401.7653444 120.05563375999998L401.7653444 160.06348391999998 L90.97198 160.06348391999998Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1408" d="M401.7653444 120.05563375999998L827.018 120.05563375999998L827.018 160.06348391999998 L401.7653444 160.06348391999998Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1409" d="M0 160.06348391999998L90.97198 160.06348391999998L90.97198 200.07133407999999 L0 200.07133407999999Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1410" d="M90.97198 160.06348391999998L401.7653444 160.06348391999998L401.7653444 200.07133407999999 L90.97198 200.07133407999999Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1411" d="M401.7653444 160.06348391999998L827.018 160.06348391999998L827.018 200.07133407999999 L401.7653444 200.07133407999999Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1412" d="M0 200.07133407999999L90.97198 200.07133407999999L90.97198 240.07918424 L0 240.07918424Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1413" d="M90.97198 200.07133407999999L401.7653444 200.07133407999999L401.7653444 240.07918424 L90.97198 240.07918424Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1414" d="M401.7653444 200.07133407999999L827.018 200.07133407999999L827.018 240.07918424 L401.7653444 240.07918424Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1415" d="M0 240.07918423999996L90.97198 240.07918423999996L90.97198 280.02286783999995 L0 280.02286783999995Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1416" d="M90.97198 240.07918423999996L401.7653444 240.07918423999996L401.7653444 280.02286783999995 L90.97198 280.02286783999995Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1417" d="M401.7653444 240.07918423999996L827.018 240.07918423999996L827.018 280.02286783999995 L401.7653444 280.02286783999995Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1418" d="M0 280.02286783999995L90.97198 280.02286783999995L90.97198 320.83279999999996 L0 320.83279999999996Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1419" d="M90.97198 280.02286783999995L401.7653444 280.02286783999995L401.7653444 320.83279999999996 L90.97198 320.83279999999996Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1420" d="M401.7653444 280.02286783999995L827.018 280.02286783999995L827.018 320.83279999999996 L401.7653444 320.83279999999996Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1421"><text id="SvgjsText1422" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="2.0039250799999984" transform="rotate(0)"><tspan id="SvgjsTspan1423" dy="24" x="0"><tspan id="SvgjsTspan1424" style="text-decoration:;">  时间顺序</tspan></tspan></text></g><g id="SvgjsG1425"><text id="SvgjsText1426" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="2.0039250799999984" transform="rotate(0)"><tspan id="SvgjsTspan1427" dy="24" x="90.97198"><tspan id="SvgjsTspan1428" style="text-decoration:;">  事务A</tspan></tspan></text></g><g id="SvgjsG1429"><text id="SvgjsText1430" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="2.0039250799999984" transform="rotate(0)"><tspan id="SvgjsTspan1431" dy="24" x="401.7653444"><tspan id="SvgjsTspan1432" style="text-decoration:;">  事务B</tspan></tspan></text></g><g id="SvgjsG1433"><text id="SvgjsText1434" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="42.01177523999999" transform="rotate(0)"><tspan id="SvgjsTspan1435" dy="24" x="0"><tspan id="SvgjsTspan1436" style="text-decoration:;">  1</tspan></tspan></text></g><g id="SvgjsG1437"><text id="SvgjsText1438" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="42.01177523999999" transform="rotate(0)"><tspan id="SvgjsTspan1439" dy="24" x="90.97198"><tspan id="SvgjsTspan1440" style="text-decoration:;">  开始事务</tspan></tspan></text></g><g id="SvgjsG1441"><text id="SvgjsText1442" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="42.01177523999999" transform="rotate(0)"></text></g><g id="SvgjsG1443"><text id="SvgjsText1444" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="82.0196254" transform="rotate(0)"><tspan id="SvgjsTspan1445" dy="24" x="0"><tspan id="SvgjsTspan1446" style="text-decoration:;">  2</tspan></tspan></text></g><g id="SvgjsG1447"><text id="SvgjsText1448" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="82.0196254" transform="rotate(0)"><tspan id="SvgjsTspan1449" dy="24" x="90.97198"><tspan id="SvgjsTspan1450" style="text-decoration:;">  第一次查询，数据总量为 100 条</tspan></tspan></text></g><g id="SvgjsG1451"><text id="SvgjsText1452" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="82.0196254" transform="rotate(0)"></text></g><g id="SvgjsG1453"><text id="SvgjsText1454" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="122.05955883999997" transform="rotate(0)"><tspan id="SvgjsTspan1455" dy="24" x="0"><tspan id="SvgjsTspan1456" style="text-decoration:;">  3</tspan></tspan></text></g><g id="SvgjsG1457"><text id="SvgjsText1458" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="122.05955883999997" transform="rotate(0)"></text></g><g id="SvgjsG1459"><text id="SvgjsText1460" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="122.05955883999997" transform="rotate(0)"><tspan id="SvgjsTspan1461" dy="24" x="401.7653444"><tspan id="SvgjsTspan1462" style="text-decoration:;">  开始事务</tspan></tspan></text></g><g id="SvgjsG1463"><text id="SvgjsText1464" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="162.06740899999997" transform="rotate(0)"><tspan id="SvgjsTspan1465" dy="24" x="0"><tspan id="SvgjsTspan1466" style="text-decoration:;">  4</tspan></tspan></text></g><g id="SvgjsG1467"><text id="SvgjsText1468" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="162.06740899999997" transform="rotate(0)"><tspan id="SvgjsTspan1469" dy="24" x="90.97198"><tspan id="SvgjsTspan1470" style="text-decoration:;">  其他操作</tspan></tspan></text></g><g id="SvgjsG1471"><text id="SvgjsText1472" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="162.06740899999997" transform="rotate(0)"></text></g><g id="SvgjsG1473"><text id="SvgjsText1474" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="202.07525915999997" transform="rotate(0)"><tspan id="SvgjsTspan1475" dy="24" x="0"><tspan id="SvgjsTspan1476" style="text-decoration:;">  5</tspan></tspan></text></g><g id="SvgjsG1477"><text id="SvgjsText1478" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="202.07525915999997" transform="rotate(0)"></text></g><g id="SvgjsG1479"><text id="SvgjsText1480" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="202.07525915999997" transform="rotate(0)"><tspan id="SvgjsTspan1481" dy="24" x="401.7653444"><tspan id="SvgjsTspan1482" style="text-decoration:;">  新增 100 条数据</tspan></tspan></text></g><g id="SvgjsG1483"><text id="SvgjsText1484" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="242.05102603999995" transform="rotate(0)"><tspan id="SvgjsTspan1485" dy="24" x="0"><tspan id="SvgjsTspan1486" style="text-decoration:;">  6</tspan></tspan></text></g><g id="SvgjsG1487"><text id="SvgjsText1488" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="242.05102603999995" transform="rotate(0)"></text></g><g id="SvgjsG1489"><text id="SvgjsText1490" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="242.05102603999995" transform="rotate(0)"><tspan id="SvgjsTspan1491" dy="24" x="401.7653444"><tspan id="SvgjsTspan1492" style="text-decoration:;">  提交事务</tspan></tspan></text></g><g id="SvgjsG1493"><text id="SvgjsText1494" font-family="微软雅黑" text-anchor="start" font-size="16px" width="91px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="282.42783391999996" transform="rotate(0)"><tspan id="SvgjsTspan1495" dy="24" x="0"><tspan id="SvgjsTspan1496" style="text-decoration:;">  7</tspan></tspan></text></g><g id="SvgjsG1497"><text id="SvgjsText1498" font-family="微软雅黑" text-anchor="start" font-size="16px" width="311px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="282.42783391999996" transform="rotate(0)"><tspan id="SvgjsTspan1499" dy="24" x="90.97198"><tspan id="SvgjsTspan1500" style="text-decoration:;">  第二次查询，数据总量为 200 条</tspan></tspan></text></g><g id="SvgjsG1501"><text id="SvgjsText1502" font-family="微软雅黑" text-anchor="start" font-size="16px" width="426px" fill="#323232" font-weight="400" align="middle" lineHeight="150%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="282.42783391999996" transform="rotate(0)"></text></g></g><g id="SvgjsG1503" transform="translate(25.003850000000057,346)"><path id="SvgjsPath1504" d="M0 0L91.00736964000001 0L91.00736964000001 40.0077 L0 40.0077Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><path id="SvgjsPath1505" d="M91.00736964000001 0L825.8382 0L825.8382 40.0077 L91.00736964000001 40.0077Z" stroke="rgba(201,208,227,1)" stroke-width="1" fill-opacity="1" fill="#f5f7fb"></path><g id="SvgjsG1506"><text id="SvgjsText1507" font-family="微软雅黑" text-anchor="start" font-size="16px" width="92px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="6.00385" transform="rotate(0)"><tspan id="SvgjsTspan1508" dy="20" x="0"><tspan id="SvgjsTspan1509" style="text-decoration:;">  备注</tspan></tspan></text></g><g id="SvgjsG1510"><text id="SvgjsText1511" font-family="微软雅黑" text-anchor="start" font-size="16px" width="735px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="6.00385" transform="rotate(0)"><tspan id="SvgjsTspan1512" dy="20" x="91.00736964000001"><tspan id="SvgjsTspan1513" style="text-decoration:;">  按照正确逻辑，事务 A 前后两次读取到的数据总量应该一致</tspan></tspan></text></g></g></svg>

解决幻读的办法：串行化。

此时的并发程度最低，效率也最低，但是数据的可靠性最高。

## 设置事务的隔离级别

首先查看当前的隔离级别：

```sql
select @@tx_isolation;
```

然后设置事务的隔离级别：

```sql
set session transaction isolation level 事务级别;
```

其中 `事务级别` 的可选值为：

* `read uncommitted`：读未提交，所有事务都可以看到其他未提交事务的执行结果。比较少用，因为性能提升不大，但容易引起脏读。
* `read committed`：读已提交，能够彻底解决脏读的现象，但可能会产生不可重复读的现象。
* `repeatable read`：可重复读，能够彻底解决脏读和不可重复读的现象，但依然会产生幻读的现象。
* `serializable`：串行化，能有效地解决脏读、不可重复读和幻读的现象，但是大大降低了数据库的性能，一般也不常用（安全和效率不能兼得）。

## 总结一下

幻读和不可重复读都是读取了另一条已经提交的事务（脏读不是这样），所不同的是不可重复读查询的是同一个数据项，而幻读针对的是一批数据整体（比如数据的个数）。

* 不可重复读的重点在修改，在同一事务中，同样的条件，第一次读取的数据和第二次读取的数据不一样（因为中间有其他事务提交了修改）。
* 幻读的重点在删除和插入，在同一事务中，同样的条件，第一次读取的记录数第二次读取的记录数不一致（因为中间有其他事务提交了插入和删除操作）。

因此解决不可重复读的问题只需锁住满足条件的那一行数据，解决幻读需要锁表。

## 后续

后面可能还要学习一下乐观锁、悲观锁。

（完）
